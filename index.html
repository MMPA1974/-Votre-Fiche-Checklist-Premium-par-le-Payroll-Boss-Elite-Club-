<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: Dynamic Pep's (Vibrant Pink, Orange, Green, Teal, Purple, Yellow) -->
    <!-- Application Structure Plan: A single-page application structured as a dual-checklist dashboard. The primary structure separates 'Academic' tasks from 'Well-being' tasks, as requested. This design choice enhances usability by allowing users to focus on two different but equally important aspects of their preparation without cognitive overload. User flow is simple: open the app, see your saved progress, check/uncheck items, and the state persists automatically via Firestore. A print function is included for offline use. This structure is more intuitive than a linear report, directly addressing the user's goal of having a practical, reusable tool. The academic checklist now features a collapsible nested structure for Blocks, Modules, and Themes for detailed progress tracking, including a dynamic progress bar for each block. -->
    <!-- Visualization & Content Choices: Report Info: The source text provides two distinct lists of tasks, plus detailed program structure. Goal: Organize and track completion with granular detail. Viz/Presentation Method: Two interactive checklist sections. The academic section includes collapsible (expand/collapse) nested lists for Blocks, Modules, and Themes, allowing users to drill down into their curriculum progress. Each block now features a visual progress bar. Exam sessions are presented in a multi-column format for clear tracking of Session 1 vs Session 2. Interaction: Users click checkboxes to toggle the completion state, which is saved in real-time to a personal Firestore document, and updates the progress bars. Collapsible headers allow users to show/hide detailed curriculum sections. A dynamic countdown shows days to the next exam. A 'Print' button offers an offline utility. Justification: This detailed, interactive structure directly addresses the user's need for granular progress tracking within their curriculum, while maintaining clarity for exam sessions and overall well-being. The real-time persistence via Firebase (Firestore) makes the tool powerful and reusable across sessions. The progress bars provide immediate visual feedback and motivation. Library/Method: Vanilla JS for logic, TailwindCSS for styling, Firebase for backend persistence. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>Fiche Checklist Premium - Payroll Boss Elite Club</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f3e7e9 0%, #e3eeff 100%);
        }
        .container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        h1, h2, h3 {
            font-weight: 800;
        }
        .checklist-item input[type="checkbox"] {
            transform: scale(1.5);
            accent-color: #ff8c00; /* Orange for general checkboxes */
        }
        .checklist-item span {
            transition: all 0.3s ease;
        }
        .checklist-item input:checked + span {
            text-decoration: line-through;
            color: #9ca3af;
        }
        @media print {
            body {
                background: none;
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
            .container {
                box-shadow: none;
                border: none;
                backdrop-filter: none;
                max-width: 100%;
                padding: 0;
            }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 1s ease-out forwards;
        }
        /* Custom styles for collapsible sections */
        .collapsible-header {
            background: linear-gradient(90deg, #ff6bcb, #ff99cc); /* Pink gradient for block headers */
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            color: white; /* White text for contrast */
            box-shadow: 0 4px 10px rgba(255, 107, 203, 0.3);
            transition: all 0.3s ease;
            margin-bottom: 5px; /* Space between headers */
        }
        .collapsible-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 107, 203, 0.4);
        }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            background-color: #ffe4f0; /* Lighter pink for content */
            border-radius: 0 0 10px 10px;
            padding: 0 20px;
        }
        .collapsible-content.expanded {
            max-height: 1000px; /* Arbitrarily large value for expansion */
            padding: 15px 20px;
            transition: max-height 0.7s ease-in;
        }
        .arrow-icon {
            transition: transform 0.3s ease;
            font-size: 1.2em; /* Make arrow slightly larger */
        }
        .arrow-icon.rotated {
            transform: rotate(90deg);
        }
        .module-header {
            background: linear-gradient(90deg, #87d3f2, #a1e4ff); /* Light blue gradient for module headers */
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #007bb6; /* Darker blue text */
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .module-header:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.12);
        }
        .module-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
            background-color: #e0f7fa; /* Lighter blue for module content */
            border-radius: 0 0 8px 8px;
            padding: 0 15px;
        }
        .module-content.expanded {
            max-height: 500px; /* Arbitrarily large value */
            padding: 10px 15px;
            transition: max-height 0.6s ease-in;
        }
        .theme-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            color: #2d3748; /* Dark gray for theme text */
        }
        .theme-item input[type="checkbox"] {
            margin-right: 10px;
            accent-color: #48bb78; /* Green for themes checkboxes */
        }
        .session-table-header {
            background: linear-gradient(90deg, #9fe6b8, #c6f6d5); /* Light green gradient */
            color: #2f855a; /* Dark green */
            padding: 10px;
            border-radius: 8px 8px 0 0;
        }
        .session-table-row {
            background-color: #ffffff; /* White for rows */
            border-bottom: 1px solid #e2e8f0;
            padding: 10px;
            transition: background-color 0.2s ease;
        }
        .session-table-row:last-child {
            border-bottom: none;
        }
        .session-table-row:hover {
            background-color: #f0fff4; /* Very light green on hover */
        }
        .session-table-row input[type="checkbox"] {
            accent-color: #38a169; /* Green for session checkboxes */
        }
        .advice-section h2, .advice-section h3 {
            color: #3182ce; /* Blue for advice headers */
        }
        .advice-section p, .advice-section li {
            margin-bottom: 1rem; /* More space for advice paragraphs */
            line-height: 1.7; /* Better readability */
        }
        /* Progress bar styles */
        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            height: 10px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #82e0aa, #38a169); /* Green gradient for progress */
            width: 0%;
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        .progress-text {
            font-size: 0.85rem;
            font-weight: 600;
            color: #2f855a;
            margin-top: 5px;
            text-align: right;
        }
    </style>
</head>
<body class="flex justify-center items-start min-h-screen p-4 sm:p-6 md:p-8">
    <div class="container max-w-4xl w-full rounded-2xl shadow-2xl p-6 sm:p-8 md:p-10 animate-fade-in">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-rose-500">
                ğŸ‰ Votre Fiche Checklist Premium
            </h1>
            <p class="text-lg text-gray-700 mt-2">par le <span class="font-bold text-orange-500">ğŸ”¥ Payroll Boss Elite Club ğŸ‘‘</span> !</p>
        </header>

        <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">
            Bienvenue, Future Boss de la Paie ! ğŸš€ PrÃ©parez-vous Ã  conquÃ©rir la promotion VINCI (DÃ©cembre 2025) avec cette fiche personnalisÃ©e qui va faire Ã©clater votre potentiel ! ğŸŒŸ Cochez chaque Ã©tape et ressentez la puissance de l'organisation ! ğŸ’ªğŸ’–
        </p>

        <div class="group-names-section text-center mb-10 p-4 bg-gradient-to-r from-yellow-100 via-orange-100 to-red-100 rounded-xl shadow-md border border-orange-200">
            <h3 class="text-xl font-bold text-orange-600 mb-2">Vos QG de la RÃ©ussite :</h3>
            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 text-gray-700 font-semibold">
                <p><strong>Discord :</strong> ğŸ”¥Payroll Boss Elite Club ğŸ‘‘| Infos & Actus</p>
                <p><strong>WhatsApp :</strong> ğŸ”¥ Payroll Boss Elite Club : Le Hub Paie & ProgrÃ¨s ğŸ“ˆ</p>
            </div>
        </div>

        <div id="countdown" class="text-center text-2xl font-bold text-purple-700 mb-8 p-4 bg-purple-100 rounded-lg shadow-md">
            <!-- Countdown will be displayed here -->
        </div>

        <div class="loading-spinner text-center my-10 hidden" id="loadingSpinner">
             <div class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] text-orange-500" role="status">
                <span class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]">Loading...</span>
            </div>
        </div>

        <main id="checklistsContainer" class="space-y-12">
            <!-- Checklists will be rendered here by JavaScript -->
        </main>
        
        <div class="advice-section bg-blue-100 p-6 rounded-xl shadow-md mt-12 text-left">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">ğŸ’¡ Conseils de Boss pour une PrÃ©paration au TOP du TOP ! ğŸ“ˆ</h2>
            
            <h3 class="text-xl font-semibold text-blue-600 mb-3">ğŸ—“ï¸ Ã€ 2 mois de l'examen : Le Grand DÃ©marrage ! ğŸš€</h3>
            <p class="text-gray-700 mb-4">C'est le moment de poser les fondations de votre succÃ¨s ! ğŸ§± Plongez dans les bases de chaque module, organisez un emploi du temps de rÃ©vision qui vous ressemble (et que vous allez <strong>ADORER</strong> suivre ! ğŸ˜‰). Identifiez vos zones de gÃ©nie et celles qui demandent un petit coup de boost pour y mettre toute votre Ã©nergie ! ğŸ¯</p>
            
            <h3 class="text-xl font-semibold text-blue-600 mb-3">ğŸ—“ï¸ Ã€ 1 mois de l'examen : L'AccÃ©lÃ©ration Finale ! âš¡</h3>
            <p class="text-gray-700 mb-4">On passe Ã  la vitesse supÃ©rieure ! ğŸš€ Intensifiez vos rÃ©visions, dÃ©fiez-vous avec des annales d'examens et des exercices types. C'est le terrain de jeu idÃ©al pour maÃ®triser votre temps et apprivoiser le stress comme une vraie Boss ! ğŸ‘‘ Pratiquez, pratiquez, pratiquez ! ğŸ§ âœ¨</p>
            
            <h3 class="text-xl font-semibold text-blue-600 mb-3">ğŸ—“ï¸ Ã€ 1 semaine de l'examen : La SÃ©rÃ©nitÃ© avant la TempÃªte ! ğŸ§˜â€â™€ï¸</h3>
            <p class="text-gray-700 mb-4">Stop aux nouvelles notions ! ğŸš« C'est la semaine de la consolidation et du bien-Ãªtre. Assurez-vous que tout votre arsenal pour l'examen est prÃªt (stylos chanceux, chargeurs, etc. !). ğŸ€ PrioritÃ© absolue : un sommeil de champion(ne) et une alimentation qui vous donne des super-pouvoirs ! ğŸğŸ˜´</p>
            
            <h3 class="text-xl font-semibold text-blue-600 mb-3">ğŸ—“ï¸ 2 jours avant l'examen & le Jour J : La Victoire est en Vue ! ğŸ†</h3>
            <p class="text-gray-700 mb-4"><strong>ON ARRÃŠTE TOUT !</strong> ğŸ›‘ Oui, oui, vous avez bien lu ! C'est le moment de dÃ©compresser et de recharger les batteries. Voici quelques astuces pour ces derniers jours cruciaux :</p>
            <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4 mb-4">
                <li><strong>Bureau au top :</strong> ğŸ§¹ PrÃ©pare ton espace de travail : dÃ©gagÃ©, propre, avec juste l'essentiel. Mieux vaut la qualitÃ© que la quantitÃ© de bouquins !</li>
                <li><strong>Tech check :</strong> ğŸ’» VÃ©rifie que ton ordi, tes Ã©crans, et tous tes outils (tÃ©lÃ©phone, etc.) fonctionnent et sont bien chargÃ©s. Pense Ã  un deuxiÃ¨me Ã©cran si tu en as besoin, on ne sait jamais !</li>
                <li><strong>Zone zÃ©ro dÃ©rangement :</strong> ğŸ¤« Assure-toi d'Ãªtre dans un espace isolÃ©. N'hÃ©site pas Ã  mettre un panneau "NE PAS DÃ‰RANGER - RISQUE DE MORSURE" sur ta porte ! ğŸ˜‚</li>
                <li><strong>Ambiance parfaite :</strong> ğŸ’¡ LumiÃ¨re agrÃ©able, bien aÃ©rÃ©, ni trop chaud, ni trop froid. Tes lunettes/lentilles Ã  portÃ©e de main !</li>
                <li><strong>Hydratation & Ã©nergie :</strong> ğŸ’§ De quoi boire (beaucoup d'EAU, pas de sucre !) et grignoter sainement (pas un repas complet !). Respecte ta pause dÃ©jeuner si tu bosses toute la journÃ©e.</li>
                <li><strong>Stop quand il faut :</strong> â° Si aprÃ¨s 3h-3h30 tu sens que tu en peux plus, STOP ! Ferme tout, prends une vraie pause (sieste, promenade), et reviens calmement. Pas de panique ! "Ã€ tout problÃ¨me, il y a deux solutions : la bonne et la bonne. Si tu ne trouves pas de rÃ©ponse Ã  ta problÃ©matique, c'est qu'il n'y a pas de problÃ¨me." ğŸ˜‰</li>
            </ul>

            <p class="text-gray-700 mb-4"><strong>Le Jour J, soyez prÃªte comme jamais :</strong></p>
            <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                <li><strong>Dernier check bureau :</strong> âœ… Ton bureau est prÃªt depuis 2 jours, mais vÃ©rifie une derniÃ¨re fois que personne n'y a touchÃ© (surtout si tu as des enfants !). Ta trousse, tes crayons, tout est lÃ  ?</li>
                <li><strong>Projection & Look de Boss :</strong> ğŸ’¼ PrÃ©pare tes vÃªtements la veille. Projette-toi : "Demain, je suis une gestionnaire de paie, je vais au bureau, je vais traiter ma paie." Habille-toi comme si tu allais vraiment travailler !</li>
                <li><strong>Bien-Ãªtre matinal :</strong> ğŸš¿ Une bonne douche fraÃ®che (si c'est l'Ã©tÃ© ou si tu aimes !), un super petit-dÃ©jeuner.</li>
                <li><strong>Mindset de champion(ne) :</strong> ğŸ§˜â€â™€ï¸ Si tu aimes, fais un peu de mÃ©ditation. Pense aux Quatre Accords ToltÃ¨ques (et au cinquiÃ¨me !). Laisse ces pensÃ©es tourner en boucle, c'est reposant.</li>
                <li><strong>Amuse-toi !</strong> ğŸ­ Prends Ã§a comme un jeu, une piÃ¨ce de thÃ©Ã¢tre oÃ¹ tu es la star. Ã‰clate-toi, c'est comme Ã§a qu'il faut prendre la vie ! Imagine que tu as des collÃ¨gues, que tu es dÃ©jÃ  Ã  ton poste.</li>
                <li>Tu es une <strong>Payroll Boss Elite</strong> ! La confiance est ton super-pouvoir ! âœ¨</li>
            </ul>
        </div>

        <footer class="mt-12 text-center no-print">
             <button id="printButton" class="bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300">
                ğŸ–¨ï¸ Imprimer ma Checklist
            </button>
            <div class="social-links mt-8">
                <p class="text-gray-700 mb-4">Ou rejoignez-nous directement pour plus de soutien :</p>
                <div class="flex justify-center gap-4">
                    <a href="https://discord.gg/cBnBkGDFgk" target="_blank" rel="noopener noreferrer" class="bg-indigo-500 text-white px-5 py-2 rounded-lg font-semibold hover:bg-indigo-600 transition-colors">Discord</a>
                    <a href="https://chat.whatsapp.com/EtV0ux5ipAG5JDhopzo0ut" target="_blank" rel="noopener noreferrer" class="bg-green-500 text-white px-5 py-2 rounded-lg font-semibold hover:bg-green-600 transition-colors">WhatsApp</a>
                </div>
            </div>
        </footer>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        
        let app, db, auth, userId;

        // Raw program data from the newsletter
        const programRawData = `Bloc_1_GÃ©rer la paie et les dÃ©clarations socialesB1_M1_ParamÃ©trer le logiciel de paieB1_M1_001_TÃ©lÃ©charger le logiciel0B1_M1_002_La base de donnÃ©es 20190B1_M1_003_Lancement de l'application0B1_M1_004_DÃ©couverte de l'application0B1_M1_005_La crÃ©ation d'une sociÃ©tÃ©0B1_M1_006_Le paramÃ©trage d'une sociÃ©tÃ©0B1_M1_007_Le paramÃ©trage de l'Ã©tablissement0B1_M1_008_La crÃ©ation des fiches salariÃ©s0B1_M1_009_Le paramÃ©trage des bulletins modÃ¨les0B1_M1_010_Le paramÃ©trage du salaire brut0B1_M1_011_Le paramÃ©trage des cotisations sociales0B1_M1_012_Le paramÃ©trage des salaires nets0B1_M1_013_Les dÃ©clarations sociales0B1_M1_014_Questions frÃ©quentes0B1_M1_015_L'AccÃ¨s Ã  d'autres logiciels de paie1B1_M1_016_SynthÃ¨se et application : ParamÃ©trer le logiciel de paie0B1_M2_Collecter et traiter les variables de paieB1_M2_001_Comment et pourquoi se former Ã  la collecte et au calcul des variables de paie1B1_M2_002_PrÃ©sentation de la Gestion de la Paie1B1_M2_003_La gestion de la paie (pour dÃ©butants)1B1_M2_004_Le temps de travail1B1_M2_005_La rÃ©munÃ©ration1B1_M2_006_La prÃ©sentation et la mÃ©thodologie du bulletin de salaire0B1_M2_007_Le rÃ¨glement du salaire0B1_M2_006_Application : Collecter et traiter les variables de paie1B1_M3_000_La prÃ©sentation et la mÃ©thodologie du bulletin de salaire1B1_M3_GÃ©rer la rÃ©munÃ©rationB1_M3_000_Le rÃ¨glement du salaire1B1_M3_001_La rÃ©munÃ©ration brute : l'acquisition et la prise de congÃ©s payÃ©s1B1_M3_002_La rÃ©munÃ©ration brute : lâ€™indemnitÃ© de congÃ©s payÃ©s0B1_M3_003_La rÃ©munÃ©ration brute : les heures complÃ©mentaires0B1_M3_004_PrÃ©sentation de la rÃ©munÃ©ration brute et de la durÃ©e lÃ©gale du travail0B1_M3_005_PrÃ©sentation de la rÃ©munÃ©ration brute et le temps de travail effectif0B1_M3_006_La rÃ©munÃ©ration brute : le salaire de base, les primes et la retenue pour absence0B1_M3_010_La rÃ©munÃ©ration brute : lâ€™arrÃªt de travail, la retenue pour absence, la subrogation et les IJSS0B1_M3_011_La rÃ©munÃ©ration brute : lâ€™arrÃªt de travail et le complÃ©ment employeur0B1_M3_012_La grÃ¨ve et le lock-out0B1_M4_Traiter les bulletins de salairesB1_M4_001_Le bulletin de salaire d'un dirigeant sans contrat de travail0B1_M4_002_L'activitÃ© partielle0B1_M4_003_Le bulletin de salaire VRP0B1_M4_004_Le bulletin de salaire du BTP (ouvrier)0B1_M4_005_Le bulletin de salaire du BTP (ETAM et Cadres)0B1_M4_006_Le bulletin de salaire Apprenti0B1_M4_007_La gratification stagiaire0B1_M4_008_SynthÃ¨se et application : Collecter et traiter les variables de paie0B1_M5_ContrÃ´ler et Ã©diter les Bulletins de paieB1_M5_001_Les diverses cotisations sociales0B1_M5_002_Les bases de calcul des cotisations sociales0B1_M5_003_Les rÃ©ductions de cotisations sociales0B1_M5_004_Les rÃ©gularisations de cotisations sociales0B1_M5_005_Le salaire net et le salaire imposableÂ 0B1_M5_006_Les impacts du prÃ©lÃ¨vement Ã  la source0B1_M5_007_Le salaire net Ã  payer et le net social0B1_M5_008_SynthÃ¨se et application : ContrÃ´ler et Ã©diter les Bulletins de paie0B1_M6_GÃ©rer les dÃ©clarations socialesB1_M6_001_Comment et pourquoi se former Ã  l'Ã©dition et au contrÃ´le des dÃ©clarations sociales0B1_M6_002_Le livre de paie0B1_M6_003_Les modalitÃ©s dÃ©claratives0B1_M6_004_Le contenu des dÃ©clarations sociales : la rÃ©duction gÃ©nÃ©rale et TEPA0B1_M6_005_Le contenu des dÃ©clarations sociales : les cotisations, le PAS et les contributions sociales0B1_M6_006_La gestion des arrÃªts de travail en paie0B1_M6_007_La taxe d'apprentissage0B1_M6_008_La gestion de la dÃ©claration d'emploi des travailleurs handicapÃ©s0B1_M6_009_Les taxes sur les salaires0B1_M6_010_La participation Ã  la formation continue0B1_M6_011_L'investissement obligatoire dans la construction0B1_M6_012_SynthÃ¨se et application : GÃ©rer les dÃ©clarations sociales0B1_M7_Analyser les Ã©carts entre la paie et la comptabilitÃ©B1_M7_001_Les enjeux de l'identification et l'analyse des Ã©carts entre la paie et la comptabilitÃ©0B1_M7_002_La prÃ©sentation du plan comptable : gÃ©nÃ©ralitÃ©s0B1_M7_003_Le grand livre comptable et les donnÃ©es paie0B1_M7_004_Les opÃ©rations comptables issues de la paie0B1_M7_005_Comptabilisation de la paie0B1_M7_006_L'analyse des causes0B1_M7_007_L'analyse des risques0B1_M7_008_Les opÃ©rations de rÃ©gularisations0B1_M7_009_SynthÃ¨se et application : Analyser les Ã©carts entre la paie et la comptabilitÃ©0Bloc_2_Assurer la Gestion administrative du personnelB2_M1_Etablir les contrats de travailB2_M1_001_La notion de droit du travail1B2_M1_002_La formation du contrat de travail1B2_M1_003_MaÃ®triser la rÃ©daction dâ€™un contrat de travail0B2_M1_004_Lâ€™exÃ©cution du contrat de travail0B2_M1_005_Le contrat de travail Ã  durÃ©e indÃ©terminÃ©e0B2_M1_006_Le CDD et le contrat de travail temporaire0B2_M1_007_Le contrat de travail Ã  temps partiel0B2_M1_008_Les contrats de formation0B2_M1_009_La rÃ©daction du contrat de travail0B2_M1_010_SynthÃ¨se et application : Etablir les contrats de travail0B2_M2_Traiter les entrÃ©es et sorties des salariÃ©sB2_M2_001_Comment et pourquoi se former Ã  gestion des parcours salariÃ©s0B2_M2_002_Le recrutement0B2_M2_003_Les formalitÃ©s administratives d'embauche0B2_M2_004_La suspension du contrat de travail0B2_M2_005_L'Ã©dition des documents de suspension du contrat0B2_M2_006_La rupture du contrat de travail : introduction0B2_M2_007_Le licenciement0B2_M2_008_Les autres modes de rupture du contrat de travail0B2_M2_009_Les fins de contrat : cas du CDD, ICP, IndemnitÃ© RTT, ...0B2_M2_010_Les fins de contrat : rupture conventionnelle, dÃ©part et mise Ã  la retraite0B2_M2_011_Les formalitÃ©s de rupture du contrat de travail0B2_M2_012_L'Ã©dition des documents de fin de contrat0B2_M2_013_SynthÃ¨se et application : Traiter les entrÃ©es et sorties des salariÃ©s0B2_M3_GÃ©rer les dossiers du personnelB2_M3_001_La stratÃ©gie globale de digitalisation de l'entreprise0B2_M3_002_La transition numÃ©rique0B2_M3_003_La digitalisation de la fonction RH0B2_M3_004_La digitalisation des dossiers du personnel0B2_M3_005_Le coffre fort numÃ©rique0B2_M3_006_RGPD : RÃ¨glement GÃ©nÃ©ral de Protection des DonnÃ©es0B2_M3_007_SynthÃ¨se et application : GÃ©rer les dossiers du personnel0B2_M4_Communiquer avec les partenaires externesB2_M4_001_Les partenaires externes du service paie0B2_M4_002_Les outils de communication du service paie avec ses partenaires0B2_M4_003_Les contrÃ´les de lâ€™application du droit du travail0B2_M4_004_Le contentieux de la relation de travail0B2_M4_005_Les procÃ©dures de rÃ¨glement des conflits collectifs0B2_M4_006_Les contrÃ´les et le contentieux social0B2_M4_007_Le rÃ´le et le contrÃ´le de l'URSSAF0Bloc_3_Conseiller et assister les dÃ©cideurs et les collaborateursB3_M1_RÃ©aliser une veille juridiqueB3_M1_001_Le conseil et l'assistance Ã  la direction et aux collaborateurs1B3_M1_002_La dÃ©marche de veille0B3_M1_003_La veille juridique0B3_M1_004_Les diffÃ©rents types de veille0B3_M1_005_La notion de droit du travail0B3_M1_006_Les sources professionnelles du droit du travail0B3_M1_007_La hiÃ©rarchie des sources du droit du travail0B3_M1_008_La protection sociale, gÃ©nÃ©ralitÃ©s0B3_M1_009_La formation professionnelle0B3_M1_010_Les pouvoirs de lâ€™employeur et la protection de la santÃ© des salariÃ©s0B3_M1_011_Comment effectuer une veille activeÂ 0B3_M1_012_Le support de communication de la veille juridique0B3_M1_013_SynthÃ¨se et application : RÃ©aliser une veille juridique0B3_M2_Diagnostiquer le conformitÃ© de la paieB3_M2_001_L'analyse documentaire0B3_M2_002_La collecte des informations auprÃ¨s des dÃ©cideurs0B3_M2_003_L'identification des Ã©carts0B3_M2_004_L'identification des risques encourus0B3_M2_005_Les actions correctrices0B3_M2_006_Le rapport de diagnostic0B3_M2_007_SynthÃ¨se et application : Diagnostiquer le conformitÃ© de la paie0B3_M3_Communiquer avec les collaborateurs et managersB3_M3_001_Les fondamentaux de la communication professionnelle0B3_M3_002_L'Ã©coute active0B3_M3_003_La communication non verbale0B3_M3_004_Les fondamentaux de la prise de parole en public0B3_M3_005_Les rÃ©unions Ã  distances0B3_M3_006_RÃ©diger une rÃ©ponse professionnelle0B3_M3_007_Les fondamentaux de la sÃ©curitÃ© sociale0B3_M3_008_Lâ€™assurance maladie du rÃ©gime gÃ©nÃ©ral0B3_M3_009_Lâ€™assurance vieillesse du rÃ©gime gÃ©nÃ©ral0B3_M3_010_La protection contre le chÃ´mage0B3_M3_011_SynthÃ¨se et application : Communiquer avec les collaborateurs et managers0B3_M4_Concevoir des supports de reporting et dâ€™aide Ã  la dÃ©cisionB3_M4_001_Les fondamentaux d'excelÂ 0B3_M4_002_Le calcul des effectifs0B3_M4_003_Le bilan social0B3_M4_004_Le recueil prÃ©alable des informations RH0B3_M4_005_L'Ã©dition des tableaux de bord sociaux0B3_M4_006_L'analyse et le suivi des tableaux de bord sociaux0B3_M4_007_L'analyse et la prÃ©vision de la masse salariale0B3_M4_008_Lâ€™association des salariÃ©s aux performances de lâ€™entreprise, gÃ©nÃ©ralitÃ©s0B3_M4_009_La participation0B3_M4_010_Â L'intÃ©ressement0B3_M4_011_Les plans dâ€™Ã©pargne salariale0B3_M4_012_SynthÃ¨se et application : Concevoir des supportsde reporting et dâ€™aide Ã  la dÃ©cision0B3_M5_Assister les utilisateurs du SIRHB3_M5_001_L'utilisation d'un SIRH0B3_M5_002_Les enjeux d'un SIRH0B3_M5_003_Les fonctionnalitÃ©s du SIRH0B3_M5_004_La rÃ©glementation inhÃ©rente aux SIRH0B3_M5_005_Introduction Ã  la notion de base de donnÃ©es0B3_M5_006_L'exploitation des bases de donnÃ©es0B3_M5_007_L'utilisation du SIRH au quotidien par le collaborateur0B3_M5_008_Proder Talentsoft ou cornerstone0B3_M5_009_La rÃ©daction des courriers Ã  destination du personnel0B3_M5_010_SynthÃ¨se et application : Assister les utilisateurs du SIRH0`;

        // Helper to clean up names and remove trailing numbers/statuses
        const cleanName = (name) => name.replace(/B\d+_M\d+_\d+_/, '').replace(/[01]$/, '').trim();

        // Improved parsing function for program data
        function parseProgramDataImproved(rawData) {
            const blocks = [];
            // Split by "Bloc_X_Name" followed by "B" to indicate start of a module or new block
            const blockRegex = /(Bloc_(\d+)_(.*?))(?=(B\d+_M\d+_)|Bloc_|$)/g;
            let blockMatch;

            // First pass to extract blocks and their raw content
            const rawBlocks = [];
            let lastIndex = 0;
            while ((blockMatch = blockRegex.exec(rawData)) !== null) {
                const blockFullString = blockMatch[0]; // e.g., "Bloc_1_GÃ©rer la paie et les dÃ©clarations socialesB1_M1_ParamÃ©trer le logiciel de paie..."
                const blockNum = blockMatch[2];
                const blockName = blockMatch[3].trim();

                // Get the content from the end of this block's definition to the start of the next block's definition
                // or to the end of the string if this is the last block.
                const nextBlockMatch = blockRegex.exec(rawData.substring(blockRegex.lastIndex));
                blockRegex.lastIndex = blockMatch.index + blockMatch[0].length; // Reset for next iteration

                const contentEndIndex = nextBlockMatch ? blockRegex.lastIndex + nextBlockMatch.index - blockMatch[0].length : rawData.length;
                const blockContentRaw = rawData.substring(blockMatch.index + blockFullString.length, contentEndIndex);

                rawBlocks.push({
                    id: `bloc-${blockNum}`,
                    name: blockName,
                    content: blockContentRaw
                });
            }

            // Second pass to parse modules and themes within each block
            rawBlocks.forEach(rawBlock => {
                const currentBlock = {
                    id: rawBlock.id,
                    name: rawBlock.name,
                    modules: []
                };
                blocks.push(currentBlock);

                const moduleRegex = /(B\d+_M\d+_(.*?))(?=(B\d+_M\d+_|$))/g; // Matches module header or start of a theme
                let moduleMatch;

                while ((moduleMatch = moduleRegex.exec(rawBlock.content)) !== null) {
                    const moduleFullString = moduleMatch[0]; // e.g., "B1_M1_ParamÃ©trer le logiciel de paieB1_M1_001_TÃ©lÃ©charger le logiciel0..."
                    const moduleCode = moduleMatch[1]; // e.g., B1_M1
                    const moduleName = moduleMatch[2].trim();

                    const currentModule = {
                        id: moduleCode.toLowerCase(),
                        name: moduleName,
                        themes: []
                    };
                    currentBlock.modules.push(currentModule);

                    const nextModuleMatch = moduleRegex.exec(rawBlock.content.substring(moduleRegex.lastIndex));
                    moduleRegex.lastIndex = moduleMatch.index + moduleMatch[0].length; // Reset for next iteration

                    const contentEndIndex = nextModuleMatch ? moduleRegex.lastIndex + nextModuleMatch.index - moduleMatch[0].length : rawBlock.content.length;
                    const moduleContentRaw = rawBlock.content.substring(moduleMatch.index + moduleFullString.length, contentEndIndex);

                    const themeRegex = /(B\d+_M\d+_\d+_.*?)([01])(?=(B\d+_M\d+_\d+_|$))/g; // Matches theme ID, name, and status
                    let themeMatch;

                    while ((themeMatch = themeRegex.exec(moduleContentRaw)) !== null) {
                        const themeId = themeMatch[1].toLowerCase().replace(/_$/, ''); // Remove trailing underscore if any
                        const themeText = cleanName(themeMatch[1]); // Corrected: Use cleanName on the full theme string
                        const initialCompletion = themeMatch[2] === '1';

                        currentModule.themes.push({
                            id: themeId,
                            text: themeText,
                            initialCompletion: initialCompletion
                        });
                    }
                }
            });

            return blocks;
        }

        const parsedProgram = parseProgramDataImproved(programRawData);

        // Function to calculate days remaining
        function getDaysRemaining(targetDateString) {
            const today = new Date();
            const [day, month, year] = targetDateString.split('/').map(Number);
            const targetDate = new Date(year, month - 1, day);

            const diffTime = targetDate.getTime() - today.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Update countdown display
        function updateCountdown() {
            const session1DateStr = '27/10/2025';
            const session2DateStr = '13/01/2026';

            const daysToSession1 = getDaysRemaining(session1DateStr);
            const daysToSession2 = getDaysRemaining(session2DateStr);

            let countdownText = '';
            if (daysToSession1 > 0 && daysToSession2 > 0) {
                if (daysToSession1 <= daysToSession2) {
                    countdownText = `â³ J-${daysToSession1} avant la Session 1 (${session1DateStr}) !`;
                } else {
                    countdownText = `â³ J-${daysToSession2} avant la Session 2 (${session2DateStr}) !`;
                }
            } else if (daysToSession1 > 0) {
                countdownText = `â³ J-${daysToSession1} avant la Session 1 (${session1DateStr}) !`;
            } else if (daysToSession2 > 0) {
                countdownText = `â³ J-${daysToSession2} avant la Session 2 (${session2DateStr}) !`;
            } else {
                countdownText = 'ğŸ‰ Les sessions d\'examens sont terminÃ©es ! FÃ©licitations !';
            }
            document.getElementById('countdown').textContent = countdownText;
        }
        
        const checklistsData = [
            {
                id: 'academic',
                title: 'âœ… Checklist AcadÃ©mique : Ma Roadmap vers le SuccÃ¨s Vinci ! ğŸ“',
                categories: [
                    { title: 'ğŸš€ DÃ©marrage & PrÃ©paration GÃ©nÃ©rale !', items: [
                        { id: 'acad-profile', text: 'ğŸ“ VÃ©rifier son Profil' },
                        { id: 'acad-certificats', text: 'âœ… RÃ©aliser les 3 Certificats Studi (QCM par bloc)' },
                        { id: 'acad-guides', text: 'ğŸ“š Consulter les diffÃ©rents guides (Formation, Blocs)' },
                        { id: 'acad-lives-bienvenue', text: 'ğŸ‘‹ S\'assurer d\'avoir bien abordÃ© la formation (guides, lives de bienvenue et de rentrÃ©e)' },
                        { id: 'acad-eval-entrainement', text: 'âœï¸ RÃ©aliser toutes les Ã©valuations d\'entraÃ®nement (fortement recommandÃ©)' },
                        { id: 'acad-forum-questions', text: 'ğŸ—£ï¸ Poser ses questions sur le forum' },
                    ]},
                    { title: 'ğŸ§  MaÃ®trise des Blocs de CompÃ©tences !', type: 'program-blocks', blocks: parsedProgram },
                    { title: 'ğŸ¯ Ã‰preuves Certifiantes par Session !', type: 'sessions', items: [
                        { id: 'acad-epreuves-certifiantes', text: 'RÃ©aliser les Ã©preuves certifiantes', // No emoji here as it's a column header
                          session1Date: '27/10/2025 - 21/11/2025',
                          session2Date: '13/01/2026 - 30/01/2026'
                        },
                    ]},
                    { title: 'ğŸ“ˆ AprÃ¨s les Ã‰preuves & Finalisation !', items: [
                        { id: 'acad-sprint-exam', text: 'ğŸƒâ€â™€ï¸ GÃ©rer l\'Exam Week + Sprint examen' },
                        { id: 'acad-session1-results', text: 'ğŸ“Š Recevoir les rÃ©sultats 1Ã¨re session (mi-dÃ©cembre 2025)' },
                        { id: 'acad-notes-bulletins', text: 'ğŸ“„ Recevoir les bulletins de notes sans dÃ©cision (Fin FÃ©vrier 2026)' },
                        { id: 'acad-final-docs', text: 'ğŸ† Recevoir les Parchemins / Attestation de blocs/bulletins finaux par mail' },
                    ]},
                ]
            },
            {
                id: 'wellness',
                title: 'ğŸŒŸ Checklist Bien-Ãªtre & Ã‰quilibre : La Boss que vous Ãªtes ! ğŸ’–',
                subtitle: 'Parce qu\'une Boss de la Paie au top, c\'est aussi une Boss Ã©panouie et sereine ! âœ¨ Prenez soin de vous, c\'est la clÃ© de la rÃ©ussite durable !',
                categories: [
                    { title: 'ğŸ§˜â€â™€ï¸ Moi, ma bulle de bonheur !', items: [
                        { id: 'well-selfcare', text: 'ğŸ›€ Prendre un moment pour soi (soin, lecture, mÃ©ditation, un bon bain moussant !)' },
                        { id: 'well-activity', text: 'ğŸ’ƒ Faire une activitÃ© physique lÃ©gÃ¨re (promenade, yoga, danse endiablÃ©e !)' },
                        { id: 'well-pleasure', text: 'ğŸ›‹ï¸ S\'accorder une pause "plaisir" (film, musique, hobby, ou juste ne rien faire !)' },
                        { id: 'well-disconnect', text: 'ğŸ“µ DÃ©connecter des Ã©crans au moins 1h avant de dormir (bye bye le tÃ©lÃ©phone !)' },
                        { id: 'well-breathing', text: 'ğŸŒ¬ï¸ Faire des exercices de respiration ou de pleine conscience (pour une zÃ©nitude absolue !)' },
                    ]},
                    { title: 'ğŸ’ª Mon corps, mon temple !', items: [
                        { id: 'well-food', text: 'ğŸ¥— PrÃ©parer des repas Ã©quilibrÃ©s et ultra-gourmands pour la semaine (miam !)' },
                        { id: 'well-sleep', text: 'ğŸ˜´ Dormir au moins 7-8 heures par nuit (le sommeil, c\'est sacrÃ© !)' },
                        { id: 'well-water', text: 'ğŸ’§ Boire suffisamment d\'eau tout au long de la journÃ©e (hydratation = super-pouvoirs !)' },
                    ]},
                    { title: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Ma tribu, ma force !', items: [
                        { id: 'well-family', text: 'Passer du temps de qualitÃ© avec la famille/les enfants (rires garantis !)' },
                        { id: 'well-friends', text: 'ğŸ¥‚ Organiser une sortie ou un appel avec des amis/partenaire (partage et bonne humeur !)' },
                    ]},
                ]
            }
        ];

        async function init() {
            document.getElementById('loadingSpinner').classList.remove('hidden');
            updateCountdown(); // Initial countdown display
            setInterval(updateCountdown, 1000 * 60 * 60 * 24); // Update daily

            // Check for valid Firebase config before initializing
            if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey || !firebaseConfig.projectId) {
                console.error("Firebase configuration is missing or incomplete. Please ensure the app is properly configured.");
                document.getElementById('checklistsContainer').innerHTML = '<p class="text-center text-red-500">Erreur: La configuration Firebase est manquante ou incomplÃ¨te. Veuillez vous assurer que l\'application est correctement configurÃ©e.</p>';
                document.getElementById('loadingSpinner').classList.add('hidden');
                return; // Stop execution if config is bad
            }

            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, user => {
                    if (user) {
                        userId = user.uid;
                        console.log("User authenticated with UID:", userId);
                        setupRealtimeListener();
                    } else {
                        signInAnonymously(auth).catch(error => console.error("Anonymous sign-in failed:", error));
                    }
                });
            } catch (e) {
                console.error("Firebase initialization failed:", e);
                document.getElementById('checklistsContainer').innerHTML = '<p class="text-center text-red-500">Erreur lors de l\'initialisation de l\'application. Veuillez rÃ©essayer.</p>';
                document.getElementById('loadingSpinner').classList.add('hidden');
            }
        }

        function getUserDocRef() {
            if (!userId) return null;
            return doc(db, `artifacts/${appId}/users/${userId}/premiumChecklist`, 'progress');
        }

        function setupRealtimeListener() {
            const userDocRef = getUserDocRef();
            if (!userDocRef) {
                console.error("User ID not available for checklist document reference.");
                document.getElementById('checklistsContainer').innerHTML = '<p class="text-center text-red-500">Erreur: ID utilisateur non disponible. Veuillez rÃ©essayer.</p>';
                document.getElementById('loadingSpinner').classList.add('hidden');
                return;
            }
            
            onSnapshot(userDocRef, (docSnap) => {
                const userProgress = docSnap.exists() ? docSnap.data() : {};
                renderChecklists(userProgress);
                document.getElementById('loadingSpinner').classList.add('hidden');
                document.getElementById('checklistsContainer').classList.remove('hidden');
            }, (error) => {
                console.error("Error fetching real-time progress:", error);
                 document.getElementById('checklistsContainer').innerHTML = '<p class="text-center text-red-500">Erreur lors du chargement de votre progression.</p>';
                document.getElementById('loadingSpinner').classList.add('hidden');
            });
        }
        
        function renderChecklists(progress) {
            const container = document.getElementById('checklistsContainer');
            container.innerHTML = '';
            checklistsData.forEach(checklist => {
                const sectionEl = document.createElement('section');
                let subtitleHTML = checklist.subtitle ? `<p class="text-center text-gray-600 mb-6">${checklist.subtitle}</p>` : '';
                let categoriesHTML = checklist.categories.map(cat => {
                    if (cat.type === 'sessions') {
                        return `
                            <div class="mb-6 bg-gray-50 p-6 rounded-xl shadow-inner">
                                <h3 class="text-lg font-bold text-purple-600 mb-3">${cat.title}</h3>
                                <div class="grid grid-cols-3 gap-2 font-bold text-gray-800 border-b-2 border-orange-300 pb-2 mb-3 session-table-header">
                                    <div>Action</div>
                                    <div class="text-center">Session 1 (${cat.items[0].session1Date})</div>
                                    <div class="text-center">Session 2 (${cat.items[0].session2Date})</div>
                                </div>
                                ${cat.items.map(item => `
                                    <div class="grid grid-cols-3 gap-2 items-center bg-white p-3 rounded-lg shadow-sm hover:bg-orange-50 cursor-pointer mb-2 session-table-row">
                                        <div class="text-gray-800">${item.text}</div>
                                        <div class="flex justify-center">
                                            <label class="flex items-center">
                                                <input type="checkbox" data-id="${item.id}-session1" class="mr-2" ${progress[`${item.id}-session1`] ? 'checked' : ''}>
                                            </label>
                                        </div>
                                        <div class="flex justify-center">
                                            <label class="flex items-center">
                                                <input type="checkbox" data-id="${item.id}-session2" class="mr-2" ${progress[`${item.id}-session2`] ? 'checked' : ''}>
                                            </label>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else if (cat.type === 'program-blocks') {
                        return `
                            <div class="mb-6">
                                <h2 class="text-2xl sm:text-3xl font-bold text-center text-orange-600 mb-4">${cat.title}</h2>
                                ${cat.blocks.map(block => {
                                    const totalThemes = block.modules.reduce((sum, mod) => sum + mod.themes.length, 0);
                                    const completedThemes = block.modules.reduce((sum, mod) => sum + mod.themes.filter(theme => progress[theme.id]).length, 0);
                                    const percentage = totalThemes > 0 ? Math.round((completedThemes / totalThemes) * 100) : 0;
                                    
                                    return `
                                    <div class="mb-4">
                                        <div class="collapsible-header" data-target="block-${block.id}">
                                            ${block.name}
                                            <span class="arrow-icon">â–¶ï¸</span>
                                        </div>
                                        <div class="progress-bar-container">
                                            <div class="progress-bar-fill" style="width: ${percentage}%;"></div>
                                        </div>
                                        <div class="progress-text">${percentage}% complÃ©tÃ©</div>
                                        <div id="block-${block.id}" class="collapsible-content">
                                            ${block.modules.map(module => `
                                                <div class="mb-3">
                                                    <div class="module-header" data-target="module-${module.id}">
                                                        ${module.name}
                                                        <span class="arrow-icon">â–¶ï¸</span>
                                                    </div>
                                                    <div id="module-${module.id}" class="module-content">
                                                        ${module.themes.map(theme => `
                                                            <label class="theme-item">
                                                                <input type="checkbox" data-id="${theme.id}" ${progress[theme.id] ? 'checked' : ''}>
                                                                <span>${theme.text}</span>
                                                            </label>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                    } else {
                        return `
                            <div class="mb-6">
                                <h3 class="text-lg font-bold text-purple-600 mb-3">${cat.title}</h3>
                                <div class="space-y-3">
                                    ${cat.items.map(item => `
                                        <label class="checklist-item flex items-center bg-white p-3 rounded-lg shadow-sm hover:bg-orange-50 cursor-pointer">
                                            <input type="checkbox" data-id="${item.id}" class="mr-4" ${progress[item.id] ? 'checked' : ''}>
                                            <span class="text-gray-800">${item.text}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }
                }).join('');
                
                sectionEl.innerHTML = `
                    <div class="bg-gray-50 p-6 rounded-xl shadow-inner">
                         <h2 class="text-2xl sm:text-3xl font-bold text-center text-orange-600 mb-4">${checklist.title}</h2>
                         ${subtitleHTML}
                         ${categoriesHTML}
                    </div>
                `;
                container.appendChild(sectionEl);
            });
            
            // Add event listeners for checkboxes
            container.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', handleCheck);
            });

            // Add event listeners for collapsible headers
            container.querySelectorAll('.collapsible-header, .module-header').forEach(header => {
                header.addEventListener('click', (event) => {
                    const targetId = event.currentTarget.dataset.target;
                    const targetContent = document.getElementById(targetId);
                    const arrowIcon = event.currentTarget.querySelector('.arrow-icon');
                    
                    if (targetContent.classList.contains('expanded')) {
                        targetContent.classList.remove('expanded');
                        arrowIcon.classList.remove('rotated');
                    } else {
                        targetContent.classList.add('expanded');
                        arrowIcon.classList.add('rotated');
                    }
                });
            });
        }
        
        async function handleCheck(event) {
            const itemId = event.target.dataset.id;
            const isChecked = event.target.checked;
            const userDocRef = getUserDocRef();
            if (!userDocRef) return;
            
            try {
                await setDoc(userDocRef, { [itemId]: isChecked }, { merge: true });
                // Re-render checklists to update progress bars
                const docSnap = await getDoc(userDocRef);
                const userProgress = docSnap.exists() ? docSnap.data() : {};
                renderChecklists(userProgress);
            } catch (e) {
                console.error("Failed to save progress:", e);
            }
        }
        
        document.getElementById('printButton').addEventListener('click', () => {
            window.print();
        });

        init();
    </script>
</body>
</html>
